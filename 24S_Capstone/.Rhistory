library(spatstat)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(RSocrata)
library(viridis)
library(spatstat)
library(raster)
library(spdep)
library(FNN)
library(grid)
library(gridExtra)
library(knitr)
library(kableExtra)
library(tidycensus)
library(lubridate)
library(extrafont)
library(ggcorrplot)
library(corrr)
rev <- read.csv('output_files/review_final_final.csv')
variables <- c("B01001_001E",
"B01001_002E",
"B01001_026E",
"B01001_007E",
"B01001_012E",
"B01001_016E",
"B01001_020E","B02001_002E","B02001_003E", "B03001_003E", "B02001_004E", "B19001_002E","B19001_003E", "B19001_006E", "B19001_008E",
"B19001_010E", "B19001_012E","B07001_001E","B07001_017E","B07001_033E",
"B07001_049E",
"B07001_065E",
"B15001_002E",
"B15001_003E",
"B15001_005E",
"B15001_009E",
"B15001_010E",
"B25001_001E",
"B06012_002E",
"B25002_003E",
"B25006_002E",
"B25006_001E",
"B19013_001E",
"B25077_001E",
"B25031_001",
"B08133_001",
"B19013_001E"
)
acs_2023 <- get_acs(
geography = "block group",
variables = variables,
year = 2015,
state = "PA",
county = "Philadelphia",
geometry = TRUE,
survey = "acs5",
output = "wide"
)
acs_2023 <- acs_2023 %>%
rename(
totalPop = B01001_001E,
male = B01001_002E,
female = B01001_026E,
age_18_24 = B01001_007E,
age_25_44 = B01001_012E,
age_45_64 = B01001_016E,
age_65plus = B01001_020E,
white = B02001_002E,
popblack = B02001_003E,
latino = B03001_003E,
other_race = B02001_004E,
income_less_20k = B19001_002E,
income_20k_40k = B19001_003E,
income_40k_60k = B19001_006E,
income_60k_80k = B19001_008E,
income_80k_100k = B19001_010E,
income_more_100k = B19001_012E,
migration_total = B07001_001E,
migration_within_county = B07001_017E,
migration_different_county_same_state = B07001_033E,
migration_different_state = B07001_049E,
migration_from_abroad = B07001_065E,
edu_less_high_school = B15001_002E,
edu_high_school_grad = B15001_003E,
edu_some_college = B15001_005E,
edu_bachelors = B15001_009E,
edu_grad_professional = B15001_010E,
total_housing_units = B25001_001E,
total_poverty = B06012_002E,
vacant_units = B25002_003E,
white_houseOwner = B25006_002E,
total_occupied_units = B25006_001E,
median_HH_income = B19013_001E,
houseprice = B25077_001E,
rent = B25031_001E,
travetimetowork = B08133_001E
) %>%
#select(-starts_with("B"),-NAME) %>%
mutate(
WhiteHOrate = white_houseOwner / total_occupied_units,
pctBachelors = ifelse(totalPop > 0, (edu_bachelors + edu_grad_professional) / totalPop, 0),
pctPoverty = ifelse(totalPop > 0, total_poverty / totalPop, 0),
pctWhitePop = ifelse(totalPop > 0, white / totalPop, 0),
pctLatinoPop = ifelse(totalPop > 0, latino / totalPop, 0),
pctBlackPop = ifelse(totalPop > 0, popblack / totalPop, 0),
pctMigration = ifelse(totalPop > 0, migration_total / totalPop, 0),
pctForeignMig = ifelse(totalPop > 0, migration_from_abroad / totalPop, 0),
pct2540 = ifelse(totalPop > 0,  age_25_44 / totalPop, 0),
landArea = st_area(geometry),
popDensity = totalPop / as.numeric(landArea)
)
acs_2023 <- acs_2023 %>%
rename(
totalPop = B01001_001E,
male = B01001_002E,
female = B01001_026E,
age_18_24 = B01001_007E,
age_25_44 = B01001_012E,
age_45_64 = B01001_016E,
age_65plus = B01001_020E,
white = B02001_002E,
popblack = B02001_003E,
latino = B03001_003E,
other_race = B02001_004E,
income_less_20k = B19001_002E,
income_20k_40k = B19001_003E,
income_40k_60k = B19001_006E,
income_60k_80k = B19001_008E,
income_80k_100k = B19001_010E,
income_more_100k = B19001_012E,
migration_total = B07001_001E,
migration_within_county = B07001_017E,
migration_different_county_same_state = B07001_033E,
migration_different_state = B07001_049E,
migration_from_abroad = B07001_065E,
edu_less_high_school = B15001_002E,
edu_high_school_grad = B15001_003E,
edu_some_college = B15001_005E,
edu_bachelors = B15001_009E,
edu_grad_professional = B15001_010E,
total_housing_units = B25001_001E,
total_poverty = B06012_002E,
vacant_units = B25002_003E,
white_houseOwner = B25006_002E,
total_occupied_units = B25006_001E,
median_HH_income = B19013_001E,
houseprice = B25077_001E,
rent = B25031_001E,
travetimetowork = B08133_001E
) %>%
#select(-starts_with("B"),-NAME) %>%
mutate(
WhiteHOrate = white_houseOwner / total_occupied_units,
pctBachelors = ifelse(totalPop > 0, (edu_bachelors + edu_grad_professional) / totalPop, 0),
pctPoverty = ifelse(totalPop > 0, total_poverty / totalPop, 0),
pctWhitePop = ifelse(totalPop > 0, white / totalPop, 0),
pctLatinoPop = ifelse(totalPop > 0, latino / totalPop, 0),
pctBlackPop = ifelse(totalPop > 0, popblack / totalPop, 0),
pctMigration = ifelse(totalPop > 0, migration_total / totalPop, 0),
pctForeignMig = ifelse(totalPop > 0, migration_from_abroad / totalPop, 0),
pct2540 = ifelse(totalPop > 0,  age_25_44 / totalPop, 0),
landArea = st_area(geometry),
popDensity = totalPop / as.numeric(landArea)
)
rev$time <- as.POSIXct(rev$time)
rev_2023 <- rev %>%
filter(format(time, "%Y") == "2023"|format(time, "%Y") == "2024")
park_rev <- rev_2023 %>%
group_by(ParkName) %>%
summarize(
avg_sentiment = sum(sentiment, na.rm = TRUE) / n(),
inspirationPct = sum(new_emotion == "Inspiration", na.rm = TRUE) / n(),
relaxationPct = sum(new_emotion == "Relaxation", na.rm = TRUE) / n(),
engagementPct = sum(new_emotion == "Engagement", na.rm = TRUE) / n(),
discoveryPct = sum(new_emotion == "Discovery", na.rm = TRUE) / n(),
sorrowPct = sum(new_emotion == "Sorrow", na.rm = TRUE) / n(),
FAPct = sum(new_emotion == "Frustration & Annoyance", na.rm = TRUE) / n(),
Lat = first(Lat),
Long = first(Long)
)
park_rev <- park_rev %>%
rowwise() %>%
mutate(geometry = st_sfc(st_point(c(Long, Lat)), crs = 4326)) %>%
ungroup() %>%
st_sf()
acs_2023 <- st_as_sf(acs_2023, crs = 4326)
acs_2023 <- acs_2023 %>%
mutate(vacantPct = vacant_units/total_housing_units,
seniorPct = age_65plus / totalPop,
kidPct = 1- (age_18_24+age_25_44+age_45_64)/totalPop)
View(acs_2023)
park_rev_merge <-st_read('reg_allvar_new_new')
park_rev_nongeo <- park_rev_merge %>% st_drop_geometry()
park_rev_nongeo %>%
dplyr::select(-highway_distance,-Lat,-Long)%>%
correlate() %>%
autoplot() +
geom_text(aes(label = round(r, digits = 2)), size = 3.5, order = "hclust", type = "upper", tl.cex = 3)
